<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Tic Tac Toe</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        window.addEventListener('mousedown',function(e){
            document.body.classList.add('mouse-navigation');
            document.body.classList.remove('kbd-navigation');
        });
        window.addEventListener('keydown', function(e){
            if(e.keyCode === 9){
                document.body.classList.add('kbd-navigation');
                document.body.classList.remove('mouse-navigation');
            }
        });
        window.addEventListener('click', function(e){
            if(e.target.tagName === 'A' && e.target.getAttribute('href') === '#'){
                e.preventDefault();
            }
        });
        window.onerror = function(message, source, line, col, error){
            var text = error ? error.stack || error : message + '(at ' + source + ':' + line + ':' + col + ')';
            errors.textContent += text + '\n';
            errors.style.display = '';
        };
        console.error = (function(old){
            return function error(){
                errors.textContent += Array.prototype.slice.call(arguments).join(' ') + '\n';
                errors.style.display ='';
                old.apply(this. arguments);
            }
        });
    </script>
    <script type="text/babel">

     /*
        class Square extends React.Component{
            render() {
                return (
                    <button 
                        className="square" 
                        onClick = { () => this.props.onClick({value:'X'})}
                    >
                        {this.props.value}
                    </button>
                );
            }
        }
        */

        function Square(props){
            return (
                <button className = {`square square-${props.idx}${props.idy}`} onClick={props.onClick}>
                    {props.value} 
                </button>
            );
        }

        function Order(props){
            return(
                <button className="toggle-order" onClick={props.onTClick}>{props.value}</button>
            );
        }

        class Board extends React.Component {      
          
            renderSquare(i){               

                return (
                    <Square 
                        value={idx[i]}
                        onClick={() => this.props.onClick(i)}
                    />
                 );
            }

            render() {
                /*
                return(
                    <div>
                        <div className="status">{status}</div>
                        <div className="board-row">
                            {this.renderSquare(0)}
                            {this.renderSquare(1)}
                            {this.renderSquare(2)}
                        </div>
                        <div className="board-row">
                            {this.renderSquare(3)}
                            {this.renderSquare(4)}
                            {this.renderSquare(5)}
                        </div>
                        <div className="board-row">
                            {this.renderSquare(6)}
                            {this.renderSquare(7)}
                            {this.renderSquare(8)}
                        </div>
                    </div>
                );
                */
               
                const rows = [[0,1,2],[3,4,5],[6,7,8]];
                return(
                    <div>
                        <div className="status">                           
                            {status}
                        </div>
                        {rows.map((row,index1) => (
                            <div className="board-row">
                                {
                                    row.map((cell,index2) => (
                                        <Square 
                                            value={this.props.squares[cell]}
                                            idx={index1}
                                            idy={index2}
                                            onClick={() => this.props.onClick(cell)}
                                        />
                                    ))}
                            </div>
                        ))}   
                                    
                    </div>
                );

              
            }
        }

        class Game extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    history: [{
                        squares: Array(9).fill(null),
                        lastmove: Array(2).fill(null),
                    }],
                    stepNumber: 0,
                    xIsNext: true,
                   ascending:true,
                };
               
            }

            handleClick(i){
                const history = this.state.history.slice(0,this.state.stepNumber + 1);
                const current = history[history.length - 1];
                const squares = current.squares.slice();
                const col = (i % 3) + 1;
                let row = 0;
                if(i<3) row = 1;
                else if(i >= 3 && i < 6) row = 2;
                else if(i >= 6 && i < 9) row = 3;
                if(calculateWinner(squares) || squares[i]){
                    return;
                }
                squares[i] = this.state.xIsNext ? 'X' : 'O';
               
                this.setState({
                    history: history.concat([{
                        squares: squares,
                        lastmove : [row,col]
                    }]),
                    stepNumber: history.length,
                    xIsNext: !this.state.xIsNext,
                   ascending:true,
                    
                });

            }

            handleToggle(){
                this.state.ascending = !this.state.ascending
                this.setState({
                    history: this.state.history.reverse(),                  
                });      
            }

            jumpTo(step){
                let el = '.square';
                $(el).css('background-color','white');
                this.setState({
                    stepNumber: step,
                    xIsNext: (step % 2) === 0,
                });
            }

            gameEnd(current){                
                let gameEnd = current.squares.filter(function(square){
                        return square != null;
                    });
                   
                if(gameEnd.length == 9)
                    return true;
                else
                    return false;
            }

            render() {
                const history = this.state.history;
                const current = history[this.state.stepNumber];
                const winner = calculateWinner(current.squares);
                let finished = false;
                
                finished = this.gameEnd(current);

                let order;
                if(this.state.ascending)
                    order = "Ascending Moves";
                else
                    order = "Descending Moves";

                const moves = history.map((step, move) => {
                    let desc = move;
                    
                    if(step.lastmove[1] != null){
                        desc = 'Go to move #' + move;
                            return (
                                <li key={move}>
                                    <p>Last Move: Row: {step.lastmove[0]}, Column: {step.lastmove[1]}</p>
                                    <button onClick={() => this.jumpTo(move)}><b>{desc}</b></button>
                                </li>
                            );                
                    }
                    else if(step.lastmove[1] == null){
                        desc = 'Go to game start';
                        return (                           
                            <li key={move}>     
                                <p>Let's get started!</p>                         
                                <button onClick={() => this.jumpTo(move)}>{desc}</button>
                            </li>
                        );
                    }
                   
                });

                let status;
                if(finished)
                    status = "GAME IS A DRAW!";
                else{
                    if (winner){
                        status = 'Winner: ' + winner;
                    } else {
                        status = "Next player: " + (this.state.xIsNext ? 'X' : 'O');
                    }
                }

                return (
                    <div className="game">
                        <div className="game-board">
                            <Board 
                                squares={current.squares}
                                onClick={(i) => this.handleClick(i)}
                            />
                        </div> 
                        <div className="game-info">
                            <Order 
                                    value = {order}
                                    onTClick={() => this.handleToggle()}
                                />
                            <div>{status}</div>
                            <ol>{moves}</ol> 
                        </div>
                    </div>
                )
            }
        }

        function calculateWinner(squares){
            const lines = [
                [0,1,2],
                [3,4,5],
                [6,7,8],
                [0,3,6],
                [1,4,7],
                [2,5,8],
                [0,4,8],
                [2,4,6]
            ];
            for (let i = 0; i < lines.length; i++){
                const [a, b, c] = lines[i];
                if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]){

                    const col = (a % 3) + 1;
                    let row = 0;
                    if(a<3) row = 1;
                    else if(a >= 3 && a < 6) row = 2;
                    else if(a >= 6 && a < 9) row = 3;
                    let el = '.square-'+(row-1)+(col-1);
                    $(el).css('background-color','yellow');

                    const col2 = (b % 3) + 1;
                    let row2 = 0;
                    if(b<3) row2 = 1;
                    else if(b >= 3 && b < 6) row2 = 2;
                    else if(b >= 6 && b < 9) row2 = 3;
                    let el2 = '.square-'+(row2-1)+(col2-1);
                    $(el2).css('background-color','yellow');

                    const col3 = (c % 3) + 1;
                    let row3 = 0;
                    if(c<3) row3 = 1;
                    else if(c >= 3 && c < 6) row3 = 2;
                    else if(c >= 6 && c < 9) row3 = 3;
                    let el3 = '.square-'+(row3-1)+(col3-1);
                    $(el3).css('background-color','yellow');

                    return squares[a];
                }
            }
            return null;
        }

        // =========================================================

        ReactDOM.render(
            <Game />,
            document.getElementById('root')
        );

    </script>
    <style>
        body {
            font: 14px "Century Gothic", Futura, sans-serif;
            margin: 20px;
        }

        ol, ul {
            padding-left: 30px;
        }

        .board-row:after {
            clear:both;
            content: "";
            display: table;
        }

        .status {
            margin-bottom: 10px;
        }

        .square {
            background: #fff;
            border: 1px solid #999;
            float: left;
            font-size: 24px;
            font-weight:bold;
            line-height: 34px;
            height: 34px;
            margin-right: -1px;
            margin-top: -1px;
            padding: 0;
            text-align: center;
            width: 34px;
        }

        .square:focus{
            outline: none;
        }

        .kbd-navigation .square:focus {
            background: #ddd;
        }

        .game {
            display: flex;
            flex-direction: row;
        }

        .game-info {
            margin-left: 20px;
        }

        .show-move {
            display:block;
        }

        .hide-move {
            display:none;
        }
        .toggle-order{
            margin-bottom:1em;
        }
    </style>
  </head>
  <body>
        <div id="errors" style="background:#c00;color:#fff;display:none;margin:-20px -20px -20px;padding:20px;white-space:pre-wrap">
        </div>
        <div id="root"></div>
        
    </body>
</html>
